## 글과 댓글, 대댓글 기능 구현하기

- 우리가 만드는 사이트 - 개발 진로 관련 정보 공유 블로그

## 글 작성하기

- 로그인한 사용자만이 글을 작성할 수 있다.
    - 제약사항
        - 글을 작성하기 위해서는 로그인을 해야한다.
        - 작성완료될 글은 제목이나 내용이 공백일 수 없다.
        
        - 추가로 고려해볼만한 사항
            - 사진과 같은 파일을 삽입하는 경우
                - 업로드된 파일이 보여질 위치를 링크와 같은 형태로 조정하는 방식 → velog 방식
                - 삽입을 하면 그 파일자체를 보여주어 이를 작성자가 옮길 수 있도록 하는 방식 → notion 방식
                - 업로드 될 파일의 크기 제한은 얼마나?
                
            - 글의 문법
                - 네이버 블로그와 같은 기본적인 문법을 따르도록 할까? (최근엔 마크다운 서식을 따르도록 업데이트 되었다고함)
                - 아니면 notion,velog와 같이 마크다운을 사용가능하도록 할까?
                
    - 시나리오
        - 글 작성(create)테스트
            - 성공 테스트
                - given
                    - 로그인한 사용자
                    - 제목과 글이 공백이 아님
                - when
                    - ‘글 작성하기’ 버튼을 누른 후 글을 작성함
                    - ‘작성’ 버튼을 눌러 글 작성을 완료함
                - then
                    - 성공적으로 글이 작성됨(201 created)
            
            - 예외 테스트
                - 상황 1. 로그인 하지 않은 사용자
                - → 이 경우는 스프링 시큐리티 url 설정으로 쉽게 해결 가능할 것이라 예측
                    - given
                        - 로그인하지않은 사용자
                    - when
                        - 사용자가 ‘글 작성하기’ 버튼을 클릭함
                    - then
                        - 로그인을 권유하는 알림을 띄우도록 함. → 프론트
                            - 오류는 (403 Forbidden)
                
                - 상황 2. 로그인 O, 글 제목 또는 내용이 공백인 경우
                    - given
                        - 로그인한 사용자
                        - 글 제목 또는 내용을 공백으로 제공
                    - when
                        - 사용자가 ‘글 작성하기’버튼을 클릭 후 글을 작성하고 ‘작성’을 눌러 글 저장을 시도
                    - then
                        - 글에서 공백으로 주어진 부분을 하이라이트하여 보여줄 수 있도록 함 →프론트
                            - 400 bad request
                

---

- 작성된 글은 아이디, 제목 등을 통해 조회가 가능해야한다.
    - 제약사항
        - ‘내 글 보기’에서는 자신이 작성한 글만 조회가 되어야 한다.
            - 이때, ‘내 글 보기’ 라는 버튼은 로그인 한 사용자들에게만 보이는 버튼
            - url을 바꾸어 접근 시도시 인가되지 않은 사용자이므로 거부하도록 시큐리티 설정
        - 만일 velog와 같이 태그를 달 수 있도록 한다면 태그를 통해서도 조회가 가능해야한다.
        
    - 시나리오
        - 글 조회(Read)테스트
            - 성공 테스트
                - 글을 작성한 작성자는 ‘내 글 보기’를 통해 자신이 쓴 글을 조회 가능하다.
                    - given
                        - 로그인한 사용자
                        - 작성된 글이 존재함
                    - when
                        - 내 글 보기 버튼을 클릭하여 작성 글 조회
                    - then
                        - 성공적으로 자신이 쓴 글을 확인할 수 있음
                            - 200 ok
            - 예외 테스트
                - 상황 1.
                - → 이 경우는 스프링 시큐리티 url 설정으로 쉽게 해결 가능할 것이라 예측
                    - given
                        - 로그인하지않은 사용자
                    - when
                        - 사용자가 ‘글 작성하기’ 버튼을 클릭함
                    - then
                        - 로그인을 권유하는 알림을 띄우도록 함.
                        - 오류는 (403 Forbidden)
                
                - 상황 2. 로그인 O, 글 제목 또는 내용이 공백인 경우
                    - given
                        - 로그인한 사용자
                        - 글 제목 또는 내용을 공백으로 제공
                    - when
                        - 사용자가 ‘글 작성하기’버튼을 클릭 후 글을 작성하고 ‘작성’을 눌러 글 저장을 시도
                    - then
                        - 글에서 공백으로 주어진 부분을 하이라이트하여 보여줄 수 있도록 함 →프론트
                        - 400 bad request
            

---

- 작성된 글은 검색결과에 노출되어야 한다.
    - 제약사항
        - 만일 글에 태그를 달 수 있도록 한다면 태그를 통해서도 조회가 가능해야한다.
        - 글 검색시 글의 제목 또는 내용에 포함된 단어를 통해 검색결과에 도출되어야 한다.
        - 글 작성자를 이용하여 검색 시, ‘ 내 글 보기’와 같이 그 사람이 작성한 글만 조회가 되어야 한다.
            - 아이디는 완전히 일치하는 경우만 찾을 수  있도록
        
    - 시나리오
        - 성공 테스트
            - given
                - 검색할 문자열 (공백 x)
                - 문자열을 통해 검색 가능한 작성된 글
            - when
                - 문자열을 통해 검색을 시도
            - then
                - 검색 가능한 글이 정상적으로 검색결과에 노출됨
                    - 200 ok
        - 예외 테스트
            - 검색할 문자열이 공백인 경우
                - given
                    - 검색할 문자열이 공백으로 제공
                - when
                    - 공백으로 검색시도
                - then
                    - 공백으로 검색이 불가능하다는 오류메세지 띄우기
                        - 400 bad request
            

---

- 글을 수정할 수 있다.
    - 제약사항
        - 글 수정은 그 글을 작성한 작성자만의 권한이다
            - 글을 작성한 작성자가 자신이 글을 작성할 때 사용한 아이디로 로그인 된 상태
                - 즉, 내 글 보기를 통해 해당 글이 보이는 상태
        - 수정한 제목, 내용이 공백이여서는 안된다.
        - 수정하기 사용시, 원래 작성했던 글의 템플릿 그대로 작성틀로 옮겨져야한다.
        - 수정한 내용을 작성을 눌러 저장하면 그 글에 수정된 내용이 덮어쓰기 되어야한다.
    - 시나리오
        - 성공 테스트
            - 수정하기 사용시, 원래 작성했던 글의 템플릿 그대로 작성틀로 옮겨져야한다.
            - given
                - 로그인한 사용자
            - when
                - 자신이 작성한 글을 눌러 수정버튼을 클릭
            - then
                - 수정한 글의 내용을 그대로 ‘작성하기’에서 사용했던 틀에 옮겨진 채로 화면에 노출
                    - 200 ok
            - 수정한 내용을 작성을 눌러 저장하면 그 글에 수정된 내용이 덮어쓰기 되어야한다.
            - given
                - 로그인한 사용자
            - when
                - 작성 버튼을 눌러 글 저장 시도
            - then
                - 수정한 글의 내용을 원래 작성했던 글에 덮어쓰기 해야함.
                    - 200 ok
        - 예외 테스트
            - 수정된 내용이 공백인 경우
                - given
                    - 로그인한 사용자
                    - 수정된 내용이 공백으로 제공
                - when
                    - 작성 버튼을 눌러 글 저장 시도
                - then
                    - 공백인 부분을 하이라이트하여 보여줌 → 프론트
                        - 400 bad request

---

- 글은 삭제할 수 있다.
    - 제약사항
        - 글을 삭제하는 것은 그 글의 작성자와 관리자만의 권한이다.
            - 글을 작성한 작성자가 자신이 글을 작성할 때 사용한 아이디로 로그인 된 상태
                - 즉, 내 글 보기를 통해 해당 글이 보이는 상태
        - 삭제된 글은 글의 댓글, 대댓글 모두 같이 삭제됨
        - 삭제된 글을 url로 접근하려할 시 404 not found
        - 진짜로 삭제할 것인지 물어보는 창을 띄우도록하기
    - 시나리오
        - 성공테스트
        - given
            - 로그인한 사용자
            - 로그인한 사용자가 작성한 삭제할 글
        - when
            - 삭제 버튼을 통해 삭제시도
        - then
            - 삭제 성공
                - 200 ok
        

---

---

---

## 댓글 기능 구현하기

-대댓글도 같은 로직을 따를 것. 다만, 다르게 구현할 필요는 있을듯

- 댓글은 로그인한 사용자들만 달 수 있다.
    - 제약사항
        - 로그인한 사용자들만 댓글 작성이 가능
        - 댓글은 공백일 수 없음
        - 작성자가 자신의 글에 댓글을 달면, 표시를 다르게하여 작성자임이 확인되도록 한다.
        - 삭제되지 않은 글에만 댓글 작성 가능
    - 시나리오
        - 성공 테스트
            - given
                - 로그인한 사용자
                - 공백이 아닌 댓글 문자열
            - when
                - 로그인한 사용자가 공백이 아닌 댓글 작성 시도
            - then
                - 성공적으로 댓글이 작성된다
                    - 201 created

---

- 댓글은 작성자/관리자만이 삭제할 수 있다.
    - 제약사항
        - 로그인한 사용자중 댓글을 작성한 사람만 댓글 삭제가 가능하다.
    - 시나리오
        - given
            - 로그인한 사용자
            - 로그인한 사용자가 작성한 삭제할 댓글
        - when
            - 삭제 버튼을 통해 삭제시도
        - then
            - 삭제 성공
                - 200 ok
            

---

- 대댓글은 상위 댓글이 삭제되더라도 삭제되지 않는다.
    - 제약사항
    - 시나리오
        - 성공테스트
            - given
                - 삭제할 대댓글을 가진 댓글
            - when
                - 삭제 버튼을 통해 댓글 삭제시도
            - then
                - 삭제 성공
                    - 200 ok
                - 삭제 후에도 대댓글은 남아있도록함.
    
    ---

---
### 참고 사이트

[대댓글 (댓글의 댓글) 기능 구현하기](https://velog.io/@hhss2259/%EB%8C%80%EB%8C%93%EA%B8%80-%EB%8C%93%EA%B8%80%EC%9D%98-%EB%8C%93%EA%B8%80-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0)

[[HTTP] HTTP 상태 401(Unauthorized) vs  403(Forbidden) 차이](https://mangkyu.tistory.com/146)

[[사소한 TIP] Spring Data JPA에서 FindBy 와 FindAllBy 차이점](https://revf.tistory.com/270)
